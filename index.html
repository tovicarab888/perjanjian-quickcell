<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUANTUM TITIP JUAL - AI Super System</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    :root {
        --quantum: #00f0ff;
        --quantum-dark: #0077ff;
        --quantum-light: #a0f0ff;
        --quantum-bg: linear-gradient(135deg, #020617 0%, #0f172a 100%);
        --danger: #ff3860;
        --success: #2ecc71;
        --warning: #ffdd57;
        --dark: #0f172a;
        --darker: #020617;
        --light: #f8fafc;
        --gray: #94a3b8;
        --border: #334155;
        --card-bg: rgba(15, 23, 42, 0.95);
        --neon-shadow: 0 0 10px var(--quantum), 0 0 20px var(--quantum), 0 0 30px var(--quantum-dark);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
        transition: all 0.3s ease;
    }

    body {
        background: var(--quantum-bg);
        color: var(--light);
        line-height: 1.6;
        font-size: 16px;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
    }

    /* Quantum Particle Background */
    #quantum-particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        opacity: 0.7;
    }

    /* Quantum Loader */
    .quantum-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(2, 6, 23, 0.95);
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
    }

    .quantum-text {
        color: var(--quantum);
        font-family: 'Orbitron', sans-serif;
        font-size: 2.5rem;
        margin-bottom: 2rem;
        text-align: center;
        text-shadow: var(--neon-shadow);
        animation: quantumPulse 2s infinite;
    }

    @keyframes quantumPulse {
        0%, 100% { opacity: 0.8; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.05); text-shadow: 0 0 20px var(--quantum), 0 0 40px var(--quantum); }
    }

    .quantum-spinner {
        width: 80px;
        height: 80px;
        border: 5px solid rgba(0, 240, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--quantum);
        animation: spin 1s linear infinite;
        position: relative;
        box-shadow: var(--neon-shadow);
    }

    .quantum-spinner::before,
    .quantum-spinner::after {
        content: '';
        position: absolute;
        border-radius: 50%;
        border: 5px solid transparent;
    }

    .quantum-spinner::before {
        top: -10px;
        left: -10px;
        right: -10px;
        bottom: -10px;
        border-top-color: rgba(0, 240, 255, 0.6);
        animation: spin 2s linear infinite;
    }

    .quantum-spinner::after {
        top: -20px;
        left: -20px;
        right: -20px;
        bottom: -20px;
        border-top-color: rgba(0, 240, 255, 0.3);
        animation: spin 3s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Main Container */
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
        position: relative;
        z-index: 1;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease;
    }

    .container.loaded {
        opacity: 1;
        transform: translateY(0);
    }

    /* Header Styles */
    .header {
        text-align: center;
        margin-bottom: 2rem;
        padding: 2rem;
        background: var(--card-bg);
        border-radius: 16px;
        border: 1px solid var(--border);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        animation: fadeInDown 0.5s ease-out;
        position: relative;
        overflow: hidden;
    }

    .header::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(0, 240, 255, 0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
        z-index: -1;
    }

    @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .logo {
        height: 120px;
        margin-bottom: 1rem;
        object-fit: contain;
        filter: drop-shadow(0 0 15px rgba(0, 240, 255, 0.7));
    }

    .title {
        font-size: 2rem;
        font-weight: 700;
        color: white;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 10px rgba(0, 240, 255, 0.5);
    }

    .subtitle {
        color: var(--quantum-light);
        font-size: 1rem;
    }

    /* Form Styles */
    .form-container {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid var(--border);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        animation: fadeInUp 0.5s ease-out;
    }

    .form-section {
        margin-bottom: 2.5rem;
        animation: fadeIn 0.6s ease-out forwards;
        opacity: 0;
        position: relative;
    }

    .form-section:nth-child(1) { animation-delay: 0.1s; }
    .form-section:nth-child(2) { animation-delay: 0.2s; }
    .form-section:nth-child(3) { animation-delay: 0.3s; }
    .form-section:nth-child(4) { animation-delay: 0.4s; }
    .form-section:nth-child(5) { animation-delay: 0.5s; }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(40px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInDown {
        from { opacity: 0; transform: translateY(-40px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--quantum);
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 0.8rem;
        text-shadow: 0 0 8px rgba(0, 240, 255, 0.3);
    }

    .section-title i {
        color: var(--quantum);
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
        position: relative;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.75rem;
        font-weight: 500;
        color: var(--quantum-light);
        font-size: 0.95rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 0.9rem 1.2rem;
        border: 1px solid var(--border);
        border-radius: 10px;
        font-size: 1rem;
        background: rgba(2, 6, 23, 0.7);
        color: var(--light);
        transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: var(--quantum);
        box-shadow: 0 0 0 3px rgba(0, 240, 255, 0.3);
        transform: translateY(-2px);
    }

    .form-group input.invalid,
    .form-group select.invalid,
    .form-group textarea.invalid {
        border-color: var(--danger);
        animation: shake 0.5s;
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        20%, 60% { transform: translateX(-5px); }
        40%, 80% { transform: translateX(5px); }
    }

    .error-message {
        color: var(--danger);
        font-size: 0.8rem;
        margin-top: 0.5rem;
        display: none;
    }

    /* Phone input with flag */
    .phone-input-container {
        position: relative;
    }

    .phone-prefix {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
        pointer-events: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .phone-input {
        padding-left: 4rem !important;
    }

    /* Face Recognition */
    .face-recognition {
        margin-top: 2rem;
        padding: 1.5rem;
        background: rgba(2, 6, 23, 0.5);
        border-radius: 10px;
        border: 1px solid var(--border);
    }

    .face-camera {
        position: relative;
        width: 100%;
        max-width: 500px;
        margin: 0 auto;
        border-radius: 10px;
        overflow: hidden;
        border: 2px solid var(--quantum);
        box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
    }

    .face-camera video,
    .face-camera canvas {
        width: 100%;
        display: block;
    }

    .face-result {
        display: none;
        margin: 1rem auto;
        max-width: 300px;
        border-radius: 10px;
        overflow: hidden;
        border: 2px solid var(--success);
    }

    .face-result img {
        width: 100%;
        display: block;
    }

    .face-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 1rem;
    }

    /* File Upload */
    .file-upload-container {
        margin-top: 1.5rem;
    }

    .upload-actions {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .file-upload-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.8rem;
        padding: 1rem 1.5rem;
        background: var(--quantum-dark);
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        flex: 1;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .file-upload-btn:hover {
        background: var(--quantum);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 240, 255, 0.3);
    }

    .file-upload-btn.single {
        background: var(--success);
    }

    .file-upload-btn.single:hover {
        background: #27ae60;
    }

    .file-upload-input {
        display: none;
    }

    .file-preview-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
    }

    .file-preview {
        position: relative;
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid var(--border);
        aspect-ratio: 1/1;
        transition: transform 0.3s;
    }

    .file-preview:hover {
        transform: scale(1.03);
        box-shadow: 0 0 15px rgba(0, 240, 255, 0.3);
    }

    .file-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .remove-file {
        position: absolute;
        top: 8px;
        right: 8px;
        background: var(--danger);
        color: white;
        border: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s;
    }

    .remove-file:hover {
        transform: scale(1.1);
        background: #e74c3c;
    }

    /* Signature Pads */
    .signature-container {
        margin-top: 2.5rem;
        padding-top: 2rem;
        border-top: 1px solid var(--border);
    }

    .signature-pads {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 1.5rem;
    }

    .signature-pad {
        border: 1px solid var(--border);
        background: white;
        border-radius: 10px;
        width: 100%;
        height: 180px;
        cursor: crosshair;
        transition: box-shadow 0.3s;
    }

    .signature-pad:hover {
        box-shadow: 0 0 0 2px var(--quantum);
    }

    .signature-label {
        display: block;
        margin-bottom: 0.75rem;
        font-weight: 500;
        color: var(--quantum-light);
        font-size: 0.95rem;
    }

    .signature-pad-container {
        position: relative;
    }

    /* Buttons */
    .btn {
        padding: 1rem 1.8rem;
        background: var(--quantum-dark);
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 500;
        cursor: pointer;
        font-size: 1rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.8rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .btn:hover {
        background: var(--quantum);
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 240, 255, 0.3);
    }

    .btn-block {
        width: 100%;
    }

    .btn-success {
        background: var(--success);
    }

    .btn-success:hover {
        background: #27ae60;
    }

    .btn-danger {
        background: var(--danger);
    }

    .btn-danger:hover {
        background: #e74c3c;
    }

    .btn-warning {
        background: var(--warning);
        color: #333;
    }

    .btn-warning:hover {
        background: #f1c40f;
    }

    /* Status indicators */
    .status-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        padding: 0.3rem 0.6rem;
        border-radius: 20px;
        margin-left: 0.5rem;
    }

    .status-red {
        background: rgba(239, 68, 68, 0.2);
        color: var(--danger);
    }

    .status-green {
        background: rgba(46, 204, 113, 0.2);
        color: var(--success);
    }

    .status-blue {
        background: rgba(0, 240, 255, 0.2);
        color: var(--quantum);
    }

    /* Price Suggestion */
    .price-suggestion {
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: rgba(46, 204, 113, 0.1);
        border-radius: 5px;
        font-size: 0.85rem;
        display: none;
    }

    .price-suggestion i {
        color: var(--success);
    }

    /* Voice Command */
    .voice-command {
        position: fixed;
        top: 1rem;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 240, 255, 0.9);
        color: var(--darker);
        padding: 0.8rem 1.5rem;
        border-radius: 50px;
        display: flex;
        align-items: center;
        gap: 0.8rem;
        z-index: 1001;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        display: none;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(0, 240, 255, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(0, 240, 255, 0); }
        100% { box-shadow: 0 0 0 0 rgba(0, 240, 255, 0); }
    }

    /* AI Assistant */
    .ai-assistant {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 1000;
    }

    .ai-button {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--quantum-dark);
        color: white;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(0, 240, 255, 0.3);
        transition: all 0.3s ease;
        position: relative;
    }

    .ai-button:hover {
        background: var(--quantum);
        transform: translateY(-5px) scale(1.1);
        box-shadow: 0 8px 30px rgba(0, 240, 255, 0.5);
    }

    .ai-button.listening {
        animation: pulse 1.5s infinite, glow 1.5s infinite alternate;
    }

    @keyframes glow {
        from { box-shadow: 0 0 10px var(--quantum); }
        to { box-shadow: 0 0 20px var(--quantum), 0 0 30px var(--quantum-dark); }
    }

    .ai-panel {
        position: absolute;
        bottom: 70px;
        right: 0;
        width: 350px;
        background: var(--card-bg);
        border-radius: 15px;
        border: 1px solid var(--border);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        padding: 1.5rem;
        display: none;
        backdrop-filter: blur(10px);
        transform-origin: bottom right;
        animation: scaleIn 0.3s ease-out;
    }

    @keyframes scaleIn {
        from { transform: scale(0.5); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    .ai-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .ai-title {
        font-weight: 600;
        color: var(--quantum);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .ai-close {
        background: none;
        border: none;
        color: var(--gray);
        font-size: 1.2rem;
        cursor: pointer;
    }

    .ai-message {
        background: rgba(0, 240, 255, 0.1);
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
        border-left: 3px solid var(--quantum);
    }

    .admin-commands {
        background: rgba(15, 23, 42, 0.7);
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
    }

    .admin-commands-title {
        font-weight: 500;
        color: var(--quantum-light);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .admin-commands-list {
        font-size: 0.9rem;
        line-height: 1.6;
    }

    .ai-actions {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.8rem;
    }

    .ai-action-btn {
        padding: 0.8rem;
        border-radius: 8px;
        border: none;
        background: var(--quantum-dark);
        color: white;
        font-size: 0.9rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: all 0.3s;
    }

    .ai-action-btn:hover {
        background: var(--quantum);
    }

    /* Modals */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(2, 6, 23, 0.95);
        z-index: 1000;
        overflow-y: auto;
        padding: 1rem;
    }

    .modal-content {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 2rem;
        max-width: 800px;
        width: 100%;
        margin: 1rem auto;
        border: 1px solid var(--border);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        animation: modalFadeIn 0.3s ease-out;
    }

    @keyframes modalFadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .modal-header {
        text-align: center;
        margin-bottom: 1.5rem;
    }

    .modal-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--quantum);
        margin-bottom: 0.5rem;
    }

    .modal-body {
        margin-bottom: 1.5rem;
        color: var(--light);
        font-size: 0.95rem;
        line-height: 1.7;
        max-height: 60vh;
        overflow-y: auto;
        padding-right: 0.8rem;
    }

    .modal-body::-webkit-scrollbar {
        width: 6px;
    }

    .modal-body::-webkit-scrollbar-thumb {
        background: var(--quantum);
        border-radius: 3px;
    }

    .modal-footer {
        text-align: center;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border);
    }

   .modal-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
    }

    /* Photo preview in modal */
    .photo-preview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }

    .photo-preview-item {
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--border);
        transition: transform 0.3s;
    }

    .photo-preview-item:hover {
        transform: scale(1.05);
    }

    .photo-preview-item img {
        width: 100%;
        height: 120px;
        object-fit: cover;
    }

    /* Footer */
    .footer {
        text-align: center;
        padding: 1.5rem;
        margin-top: 2rem;
        background: var(--card-bg);
        border-radius: 16px;
        border: 1px solid var(--border);
    }

    .tech-stack {
        display: flex;
        justify-content: center;
        gap: 0.8rem;
        flex-wrap: wrap;
        margin-top: 1rem;
    }

    .tech-badge {
        background: rgba(0, 240, 255, 0.1);
        color: var(--quantum-light);
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.8rem;
        border: 1px solid var(--quantum);
    }

    /* Conditional Fields */
    .conditional-field {
        display: none;
        animation: fadeIn 0.5s ease-out;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .upload-actions {
            flex-direction: column;
        }
        
        .modal-actions {
            flex-direction: column;
        }
        
        .btn {
            width: 100%;
        }
        
        .photo-preview-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .signature-pads {
            grid-template-columns: 1fr;
        }

        .header {
            padding: 1.5rem 1rem;
        }

        .form-container {
            padding: 1.5rem;
        }
        
        .title {
            font-size: 1.5rem;
        }
        
        .quantum-text {
            font-size: 1.5rem;
        }

        .ai-panel {
            width: 300px;
            right: -20px;
        }
    }

    @media (max-width: 576px) {
        .ai-panel {
            width: 280px;
            right: -30px;
        }
        
        .face-camera {
            height: 250px;
        }
    }

    /* Print styles */
    @media print {
        body * {
            visibility: hidden;
        }
        .modal-content, .modal-content * {
            visibility: visible;
        }
        .modal-content {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: auto;
            border: none;
            box-shadow: none;
        }
    }
    </style>
</head>
<body>
    <!-- Quantum Particle Background -->
    <div id="quantum-particles"></div>

    <!-- Quantum Loader -->
    <div class="quantum-loader" id="quantum-loader">
        <div class="quantum-text">QUICKCELLS    BDG..</div>
        <div class="quantum-spinner"></div>
    </div>

    <!-- Voice Command Indicator -->
    <div class="voice-command" id="voice-command">
        <i class="fas fa-microphone"></i>
        <span id="voice-text">Mendengarkan perintah suara...</span>
    </div>

    <!-- AI Assistant -->
    <div class="ai-assistant">
        <button class="ai-button" id="ai-button" title="AI Assistant">
            <i class="fas fa-robot"></i>
        </button>
        <div class="ai-panel" id="ai-panel">
            <div class="ai-header">
                <div class="ai-title"><i class="fas fa-robot"></i> QUANTUM AI ASSISTANT</div>
                <button class="ai-close" id="ai-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="ai-message" id="ai-message">
                Halo Admin! Saya Quantum AI Assistant siap membantu Anda. Katakan "Halo Quantum" untuk memulai perintah suara.
            </div>
            <div class="admin-commands">
                <div class="admin-commands-title"><i class="fas fa-lightbulb"></i> Contoh Perintah:</div>
                <div class="admin-commands-list">
                    "Isi data pemilik"<br>
                    "Cek harga iPhone 13"<br>
                    "Generate PDF"<br>
                    "Reset form"<br>
                    "Buka kamera"<br>
                    "Ganti kamera"<br>
                    "Verifikasi wajah"
                </div>
            </div>
            <div class="ai-actions">
                <button class="ai-action-btn" id="voice-command-btn"><i class="fas fa-microphone"></i> Perintah Suara</button>
                <button class="ai-action-btn" id="auto-fill-btn"><i class="fas fa-magic"></i> Auto Fill</button>
                <button class="ai-action-btn" id="price-check-btn"><i class="fas fa-search-dollar"></i> Cek Harga</button>
                <button class="ai-action-btn" id="face-verify-btn"><i class="fas fa-user-check"></i> Verifikasi Wajah</button>
            </div>
        </div>
    </div>
        <!-- Sound Effects -->
    <audio class="sound-effect" id="upload-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3"></audio>
    <audio class="sound-effect" id="success-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>
    <audio class="sound-effect" id="error-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3"></audio>
    <audio class="sound-effect" id="voice-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-modern-click-tech-2582.mp3"></audio>

    <!-- Main Container -->
    <div class="container" id="main-container">
        <header class="header">
            <img src="https://i.imgur.com/8QHjrmd.png" alt="Quantum Titip Jual Logo" class="logo" title="Quantum Titip Jual">   
            <h1 class="title">PERJANJIAN TITIP JUAL HANDPHONE <span class="status-indicator status-blue">QUANTUM AI SYSTEM</span></h1>
            <p class="subtitle">Dengan Teknologi Quantum AI, Face Recognition & Voice Control</p>
        </header>

        <div class="form-container">
            <form id="quantum-form">
                <!-- Data Pemilik -->
                <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-user-tag"></i> Data Pemilik</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="full-name"><i class="fas fa-user"></i> Nama Lengkap</label>
                            <input type="text" id="full-name" required title="Masukkan nama lengkap Anda">
                            <div class="error-message" id="full-name-error">Nama lengkap harus diisi</div>
                        </div>
                        <div class="form-group">
                            <label for="ktp"><i class="fas fa-id-card"></i> Nomor KTP</label>
                            <input type="text" id="ktp" inputmode="numeric" pattern="[0-9]*" minlength="16" maxlength="16" required title="Masukkan 16 digit nomor KTP">
                            <div class="error-message" id="ktp-error">Nomor KTP harus 16 digit angka</div>
                        </div>
                        <div class="form-group phone-input-container">
                            <label for="phone"><i class="fas fa-phone"></i> Nomor WhatsApp</label>
                            <span class="phone-prefix"><i class="fas fa-flag"></i> +62</span>
                            <input type="tel" id="phone" class="phone-input" inputmode="numeric" pattern="[0-9]*" minlength="9" maxlength="13" required title="Masukkan nomor WhatsApp mulai dari angka 8 (tanpa 0)">
                            <div class="error-message" id="phone-error">Nomor harus diawali 8 dan minimal 9 digit (setelah +62)</div>
                        </div>
                        <div class="form-group">
                            <label for="email"><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="email" required title="Masukkan alamat email yang valid">
                            <div class="error-message" id="email-error">Email tidak valid</div>
                        </div>
                        <div class="form-group">
                            <label for="address"><i class="fas fa-map-marker-alt"></i> Alamat Lengkap</label>
                            <textarea id="address" required title="Masukkan alamat lengkap Anda"></textarea>
                            <div class="error-message" id="address-error">Alamat harus diisi</div>
                        </div>
                    </div>
                    
                    <!-- Face Recognition -->
                    <div class="face-recognition">
                        <h4 class="section-title"><i class="fas fa-camera"></i> Verifikasi Wajah Pemilik</h4>
                        <div class="face-camera">
                            <video id="face-video" autoplay muted></video>
                            <canvas id="face-canvas"></canvas>
                        </div>
                        <div class="face-result" id="face-result">
                            <img id="face-image" src="" alt="Foto Wajah">
                        </div>
                        <div class="face-actions">
                            <button type="button" class="btn" id="capture-face" title="Ambil foto wajah">
                                <i class="fas fa-camera"></i> Ambil Foto
                            </button>
                            <button type="button" class="btn btn-warning" id="switch-camera" title="Ganti kamera">
                                <i class="fas fa-sync-alt"></i> Ganti Kamera
                            </button>
                            <button type="button" class="btn btn-danger" id="retake-face" style="display:none;" title="Ulangi foto">
                                <i class="fas fa-sync-alt"></i> Ulangi
                            </button>
                            <button type="button" class="btn btn-success" id="use-face" style="display:none;" title="Gunakan foto ini">
                                <i class="fas fa-check"></i> Gunakan
                            </button>
                        </div>
                        <div class="error-message" id="face-error" style="display:none;">Foto wajah diperlukan</div>
                    </div>
                    
                    <!-- KTP Upload -->
                    <div class="file-upload-container">
                        <h4 class="section-title"><i class="fas fa-id-card"></i> Foto KTP</h4>
                        <div class="upload-actions">
                            <label for="ktp-upload" class="file-upload-btn" title="Upload foto KTP">
                                <i class="fas fa-upload"></i> Upload Foto KTP
                                <input type="file" id="ktp-upload" class="file-upload-input" accept="image/*">
                            </label>
                        </div>
                        <div id="ktp-preview" class="file-preview-container"></div>
                        <div class="error-message" id="ktp-photo-error" style="display:none;">Foto KTP diperlukan</div>
                    </div>
                </div>

                <!-- Data Handphone -->
                <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-mobile-alt"></i> Data Handphone</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="phone-brand"><i class="fas fa-mobile"></i> Merek Handphone</label>
                            <input type="text" id="phone-brand" required title="Masukkan merek handphone (contoh: Samsung, iPhone)">
                            <div class="error-message" id="phone-brand-error">Merek handphone harus diisi</div>
                            <div class="price-suggestion" id="price-suggestion">
                                <i class="fas fa-lightbulb"></i> Harga rekomendasi: <span id="suggested-price"></span>
                                <button type="button" class="btn btn-success btn-sm" onclick="applySuggestedPrice()" style="margin-left:0.5rem;padding:0.2rem 0.5rem;font-size:0.7rem;">
                                    <i class="fas fa-check"></i> Terapkan
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="phone-model"><i class="fas fa-mobile-button"></i> Model Handphone</label>
                            <input type="text" id="phone-model" required title="Masukkan model handphone (contoh: Galaxy S23, iPhone 14 Pro)">
                            <div class="error-message" id="phone-model-error">Model handphone harus diisi</div>
                        </div>
                        <div class="form-group">
                            <label for="phone-condition"><i class="fas fa-info-circle"></i> Kondisi Handphone</label>
                            <select id="phone-condition" required>
                                <option value="">-- Pilih --</option>
                                <option value="Baru">Baru</option>
                                <option value="Bekas">Bekas</option>
                            </select>
                        </div>
                        <div class="form-group conditional-field" id="completeness-wrapper">
                            <label for="phone-completeness"><i class="fas fa-check-circle"></i> Kelengkapan</label>
                            <select id="phone-completeness">
                                <option value="">-- Pilih --</option>
                                <option value="Lengkap">Lengkap</option>
                                <option value="Tidak Lengkap">Tidak Lengkap</option>
                            </select>
                        </div>
                        <div class="form-group conditional-field" id="completeness-detail-wrapper">
                            <label for="completeness-detail"><i class="fas fa-comment-dots"></i> Detail Kelengkapan</label>
                            <input type="text" id="completeness-detail" placeholder="Contoh: Unit saja, Unit + Charger tanpa box">
                            <div class="error-message" id="completeness-detail-error">Detail kelengkapan harus diisi</div>
                        </div>
                        <div class="form-group">
                            <label for="ram"><i class="fas fa-memory"></i> RAM (GB)</label>
                            <input type="number" id="ram" min="1" max="64" title="Masukkan jumlah RAM dalam GB">
                        </div>
                        <div class="form-group">
                            <label for="storage"><i class="fas fa-hdd"></i> Penyimpanan (GB)</label>
                            <input type="number" id="storage" min="8" max="1024" title="Masukkan kapasitas penyimpanan dalam GB">
                        </div>
                        <div class="form-group">
                            <label for="imei1"><i class="fas fa-barcode"></i> IMEI 1</label>
                            <input type="text" id="imei1" inputmode="numeric" pattern="[0-9]{15}" minlength="15" maxlength="15" required title="Masukkan 15 digit IMEI 1">
                            <div class="error-message" id="imei1-error">IMEI harus 15 digit angka</div>
                        </div>
                        <div class="form-group">
                            <label for="imei2"><i class="fas fa-barcode"></i> IMEI 2 (Jika Ada)</label>
                            <input type="text" id="imei2" inputmode="numeric" pattern="[0-9]{15}" minlength="15" maxlength="15" title="Masukkan 15 digit IMEI 2 (jika ada)">
                            <div class="error-message" id="imei2-error">IMEI harus 15 digit angka</div>
                        </div>
                        <div class="form-group price-input">
                            <label for="price"><i class="fas fa-tag"></i> Harga Setor (Rp)</label>
                            <span class="price-prefix">Rp</span>
                            <input type="text" id="price" inputmode="decimal" required title="Masukkan harga setor handphone">
                            <div class="error-message" id="price-error">Harga harus diisi</div>
                        </div>
                        <div class="form-group">
                            <label for="start-date"><i class="fas fa-calendar"></i> Tanggal Mulai</label>
                            <input type="date" id="start-date" required title="Tanggal mulai perjanjian">
                        </div>
                        <div class="form-group">
                            <label for="end-date"><i class="fas fa-calendar-check"></i> Tanggal Berakhir</label>
                            <input type="date" id="end-date" readonly title="Tanggal berakhir perjanjian (14 hari setelah mulai)">
                        </div>
                    </div>

                    <!-- Upload Foto Handphone -->
                    <div class="file-upload-container">
                        <h4 class="section-title"><i class="fas fa-camera"></i> Foto Handphone (Min. 3 Foto)</h4>
                        <div class="upload-actions">
                            <label for="multi-upload" class="file-upload-btn" title="Upload beberapa foto sekaligus (maksimal 10)">
                                <i class="fas fa-layer-group"></i> Upload Multiple (Maks. 10)
                                <input type="file" id="multi-upload" class="file-upload-input" accept="image/*" multiple>
                            </label>
                            <label for="single-upload" class="file-upload-btn single" title="Upload foto satu per satu">
                                <i class="fas fa-image"></i> Tambah Foto Satu-satu
                                <input type="file" id="single-upload" class="file-upload-input" accept="image/*">
                            </label>
                        </div>
                        <div id="file-preview" class="file-preview-container"></div>
                        <div class="error-message" id="photo-error" style="display:none;">Minimal 3 foto harus diupload</div>
                    </div>
                </div>
                
                <!-- Data Admin -->
                <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-user-shield"></i> Data Admin</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="admin-name"><i class="fas fa-user-tie"></i> Nama Admin</label>
                            <input type="text" id="admin-name" required title="Masukkan nama admin Quantum">
                            <div class="error-message" id="admin-name-error">Nama admin harus diisi</div>
                        </div>
                        <div class="form-group">
                            <label for="admin-ktp"><i class="fas fa-id-card"></i> Nomor KTP Admin</label>
                            <input type="text" id="admin-ktp" inputmode="numeric" pattern="[0-9]*" minlength="16" maxlength="16" required title="Masukkan 16 digit nomor KTP admin">
                            <div class="error-message" id="admin-ktp-error">Nomor KTP harus 16 digit angka</div>
                        </div>
                        <div class="form-group phone-input-container">
                            <label for="admin-phone"><i class="fas fa-phone-volume"></i> Nomor WhatsApp</label>
                            <span class="phone-prefix"><i class="fas fa-flag"></i> +62</span>
                            <input type="tel" id="admin-phone" class="phone-input" inputmode="numeric" pattern="[0-9]*" minlength="9" maxlength="13" required title="Masukkan nomor WhatsApp admin mulai dari angka 8 (tanpa 0)">
                            <div class="error-message" id="admin-phone-error">Nomor harus diawali 8 dan minimal 9 digit (setelah +62)</div>
                        </div>
                        <div class="form-group">
                            <label for="admin-email"><i class="fas fa-envelope-open-text"></i> Email</label>
                            <input type="email" id="admin-email" required title="Masukkan alamat email admin yang valid">
                            <div class="error-message" id="admin-email-error">Email tidak valid</div>
                        </div>
                    </div>
                </div>

                <!-- Tanda Tangan Digital -->
                <div class="form-section signature-container">
                    <h3 class="section-title"><i class="fas fa-signature"></i> Tanda Tangan Digital</h3>
                    <div class="signature-pads">
                        <div class="signature-pad-container">
                            <label class="signature-label"><i class="fas fa-user-pen"></i> Tanda Tangan Pemilik</label>
                            <canvas class="signature-pad" id="owner-signature" title="Silahkan tanda tangan di area ini"></canvas>
                            <div class="error-message" id="owner-signature-error" style="display:none;">Tanda tangan pemilik diperlukan</div>
                            <button type="button" class="btn btn-danger" id="clear-owner" title="Hapus tanda tangan">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                            <span id="sign-status-owner" class="status-indicator status-red"><i class="fas fa-times"></i> Belum TTD</span>
                        </div>
                        <div class="signature-pad-container">
                            <label class="signature-label"><i class="fas fa-user-gear"></i> Tanda Tangan Admin</label>
                            <canvas class="signature-pad" id="admin-signature" title="Silahkan tanda tangan di area ini"></canvas>
                            <div class="error-message" id="admin-signature-error" style="display:none;">Tanda tangan admin diperlukan</div>
                            <button type="button" class="btn btn-danger" id="clear-admin" title="Hapus tanda tangan">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                            <span id="sign-status-admin" class="status-indicator status-red"><i class="fas fa-times"></i> Belum TTD</span>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-block" id="submit-btn" title="Lanjutkan ke review perjanjian">
                    <i class="fas fa-file-contract"></i> Lanjut ke Perjanjian
                </button>
            </form>
        </div>

        <!-- Preview Modal -->
        <div class="modal" id="preview-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Review Perjanjian</h2>
                </div>
                <div class="modal-body" id="preview-content">
                    <!-- Content akan diisi oleh JavaScript -->
                </div>
                <div class="modal-footer">
                    <div class="modal-actions">
                        <button class="btn btn-success" id="generate-pdf" title="Download dokumen PDF">
                            <i class="fas fa-file-pdf"></i> Download PDF
                        </button>
                        <button class="btn btn-danger" id="close-preview" title="Tutup preview">
                            <i class="fas fa-times"></i> Tutup
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div class="modal" id="success-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Perjanjian Berhasil Di-download!</h2>
                </div>
                <div class="modal-body">
                    <p>Dokumen perjanjian telah berhasil di-generate. Silahkan kirim file PDF ini ke customer melalui WhatsApp secara manual.</p>
                    <p>File telah tersimpan di folder Downloads Anda.</p>
                </div>
                <div class="modal-footer">
                    <button class="btn" id="close-modal" title="Tutup notifikasi">
                        <i class="fas fa-times"></i> Tutup
                    </button>
                </div>
            </div>
        </div>

              <footer class="footer">
            <p>© 2025 QUCIKCELLS TITIP JUAL - <span id="admin-name-footer">Quantum Admin</span> | Perjanjian Titip Jual Handphone</p>
            <p class="tech-stack">
                <span class="tech-badge">Quantum AI Powered</span>
                <span class="tech-badge">Face Recognition</span>
                <span class="tech-badge">Voice Control</span>
                <span class="tech-badge">Real-time Price Check</span>
            </p>
        </footer>
    </div>
        <!-- Script Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Main Script -->
    <script>
    // ==================== PART 1: MAIN INITIALIZATION ====================
    const { jsPDF } = window.jspdf;
    let ownerSignaturePad, adminSignaturePad;
    let uploadedFiles = [];
    let capturedFaceImage = null;
    let faceStream = null;
    let faceDetectionInterval = null;
    let isListening = false;
    let currentCommand = '';
    let recognition;
    let currentCamera = 'user'; // 'user' for front, 'environment' for back

    document.addEventListener('DOMContentLoaded', function() {
        // Initialize quantum particles
        initParticles();
        
        // Initialize systems with slight delay for dramatic effect
        setTimeout(() => {
            initSignaturePads();
            initDateFields();
            initFormValidation();
            initFileUpload();
            initModalHandlers();
            initFaceRecognition();
            initVoiceRecognition();
            initAIAssistant();
            initConditionalForm();
            startWakeWordDetection();
            
            // Hide loader and show main content
            setTimeout(() => {
                document.getElementById('quantum-loader').style.display = 'none';
                document.getElementById('main-container').classList.add('loaded');
                
                // Welcome message
                speak("Halo Admin! Selamat datang di sistem perjanjian titip jual Quantum AI. Silakan mulai dengan mengatakan 'Halo Quantum' atau klik ikon AI di pojok kanan bawah.");
                
                // Load any saved draft
                loadDraft();
            }, 500);
        }, 2000);
    });

    // Initialize quantum particle background
    function initParticles() {
        particlesJS('quantum-particles', {
            "particles": {
                "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
                "color": { "value": "#00f0ff" },
                "shape": { "type": "circle" },
                "opacity": { "value": 0.5, "random": true },
                "size": { "value": 3, "random": true },
                "line_linked": { "enable": true, "distance": 150, "color": "#00f0ff", "opacity": 0.4, "width": 1 },
                "move": {
                    "enable": true, "speed": 2, "direction": "none", 
                    "random": true, "straight": false, "out_mode": "out", 
                    "bounce": false, "attract": { "enable": true, "rotateX": 600, "rotateY": 1200 }
                }
            },
            "interactivity": {
                "detect_on": "canvas", "events": {
                    "onhover": { "enable": true, "mode": "grab" },
                    "onclick": { "enable": true, "mode": "push" },
                    "resize": true
                },
                "modes": { "grab": { "distance": 140, "line_linked": { "opacity": 1 } }, "push": { "particles_nb": 4 } }
            },
            "retina_detect": true
        });
    }

    // Initialize signature pads
    function initSignaturePads() {
        ownerSignaturePad = new SignaturePad(document.getElementById('owner-signature'), {
            backgroundColor: 'rgba(255, 255, 255, 0)',
            penColor: 'rgb(0, 0, 0)'
        });
        
        adminSignaturePad = new SignaturePad(document.getElementById('admin-signature'), {
            backgroundColor: 'rgba(255, 255, 255, 0)',
            penColor: 'rgb(0, 0, 0)'
        });
        
        // Clear buttons
        document.getElementById('clear-owner').addEventListener('click', function() {
            ownerSignaturePad.clear();
            document.getElementById('sign-status-owner').className = 'status-indicator status-red';
            document.getElementById('sign-status-owner').innerHTML = '<i class="fas fa-times"></i> Belum TTD';
        });
        
        document.getElementById('clear-admin').addEventListener('click', function() {
            adminSignaturePad.clear();
            document.getElementById('sign-status-admin').className = 'status-indicator status-red';
            document.getElementById('sign-status-admin').innerHTML = '<i class="fas fa-times"></i> Belum TTD';
        });
        
        // Signature status change
        ownerSignaturePad.onEnd = function() {
            document.getElementById('sign-status-owner').className = 'status-indicator status-green';
            document.getElementById('sign-status-owner').innerHTML = '<i class="fas fa-check"></i> Sudah TTD';
        };
        
        adminSignaturePad.onEnd = function() {
            document.getElementById('sign-status-admin').className = 'status-indicator status-green';
            document.getElementById('sign-status-admin').innerHTML = '<i class="fas fa-check"></i> Sudah TTD';
        };
    }

    // Initialize date fields
    function initDateFields() {
        const startDate = document.getElementById('start-date');
        const endDate = document.getElementById('end-date');
        
        // Set default start date to today
        const today = new Date().toISOString().split('T')[0];
        startDate.value = today;
        
        // Calculate end date (14 days from start)
        startDate.addEventListener('change', function() {
            if (this.value) {
                const date = new Date(this.value);
                date.setDate(date.getDate() + 14);
                endDate.value = date.toISOString().split('T')[0];
            }
        });
        
        // Trigger initial calculation
        if (startDate.value) {
            const date = new Date(startDate.value);
            date.setDate(date.getDate() + 14);
            endDate.value = date.toISOString().split('T')[0];
        }
    }

    // Initialize form validation
    function initFormValidation() {
        const form = document.getElementById('quantum-form');
        
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (validateForm()) {
                showPreview();
            } else {
                playSound('error');
                speak("Form belum lengkap. Silakan periksa kembali data yang Anda masukkan.");
            }
        });
    }
        // Validate form
    function validateForm() {
        let isValid = true;

        // Validate required fields
        const requiredFields = [
            'full-name', 'ktp', 'phone', 'email', 'address',
            'phone-brand', 'phone-model', 'imei1', 'price',
            'admin-name', 'admin-ktp', 'admin-phone', 'admin-email',
            'start-date', 'end-date'
        ];

        requiredFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            const error = document.getElementById(`${fieldId}-error`);

            if (!field || !error) return;

            const value = field.value.trim();

            if (!value) {
                isValid = false;
                field.classList.add('invalid');
                error.style.display = 'block';
            } else {
                field.classList.remove('invalid');
                error.style.display = 'none';
            }
        });

        // Validate phone numbers
        ['phone', 'admin-phone'].forEach(id => {
            const field = document.getElementById(id);
            const value = field?.value.trim();

            if (value && (!value.startsWith('8') || value.length < 9)) {
                isValid = false;
                field.classList.add('invalid');
                document.getElementById(`${id}-error`).style.display = 'block';
            }
        });

        // Validate emails
        ['email', 'admin-email'].forEach(id => {
            const field = document.getElementById(id);
            const value = field?.value.trim();

            const isValidEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
            if (value && !isValidEmail) {
                isValid = false;
                field.classList.add('invalid');
                document.getElementById(`${id}-error`).style.display = 'block';
            }
        });

        // Validate KTP numbers
        ['ktp', 'admin-ktp'].forEach(id => {
            const field = document.getElementById(id);
            const value = field?.value.trim();

            if (value && value.length !== 16) {
                isValid = false;
                field.classList.add('invalid');
                document.getElementById(`${id}-error`).style.display = 'block';
            }
        });

        // Validate IMEI numbers
        ['imei1', 'imei2'].forEach(id => {
            const field = document.getElementById(id);
            const value = field?.value.trim();

            if (value && value.length !== 15 && id === 'imei1') {
                isValid = false;
                field.classList.add('invalid');
                document.getElementById(`${id}-error`).style.display = 'block';
            }
        });

        // Validate price
        const priceField = document.getElementById('price');
        const priceValue = priceField?.value.replace(/[^0-9]/g, '') || '0';
        if (parseInt(priceValue, 10) === 0) {
            isValid = false;
            priceField.classList.add('invalid');
            document.getElementById('price-error').style.display = 'block';
        }

        // Validate photos
        if (uploadedFiles.length < 3 && !capturedFaceImage) {
            isValid = false;
            const photoError = document.getElementById('photo-error');
            if (photoError) photoError.style.display = 'block';
        }

        // Validate signatures
        if (ownerSignaturePad?.isEmpty()) {
            isValid = false;
            document.getElementById('owner-signature-error').style.display = 'block';
        }

        if (adminSignaturePad?.isEmpty()) {
            isValid = false;
            document.getElementById('admin-signature-error').style.display = 'block';
        }

        return isValid;
    }
    
    
    // ==================== PART 2: FILE UPLOAD & FACE RECOGNITION ====================
    function initFileUpload() {
        // KTP Upload
        const ktpInput = document.getElementById('ktp-upload');
        ktpInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > 20 * 1024 * 1024) {
                alert('Ukuran file maksimal 20MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const ktpPreview = document.getElementById('ktp-preview');
                ktpPreview.innerHTML = `
                    <div class="file-preview">
                        <img src="${event.target.result}" alt="Preview KTP">
                        <button class="remove-file" title="Hapus KTP"><i class="fas fa-times"></i></button>
                    </div>
                `;
                
                ktpPreview.querySelector('.remove-file').addEventListener('click', function() {
                    ktpPreview.innerHTML = '';
                    ktpInput.value = '';
                });
                
                document.getElementById('ktp-photo-error').style.display = 'none';
                playSound('upload');
            };
            reader.readAsDataURL(file);
        });

        // Multiple Files Upload
        const multiUpload = document.getElementById('multi-upload');
        multiUpload.addEventListener('change', function(e) {
            handleFileUpload(e.target.files);
        });

        // Single File Upload
        const singleUpload = document.getElementById('single-upload');
        singleUpload.addEventListener('change', function(e) {
            handleFileUpload(e.target.files);
        });
    }

    function handleFileUpload(files) {
        if (!files || files.length === 0) return;

        if (files.length > 10) {
            alert('Maksimal upload 10 file sekaligus');
            return;
        }

        Array.from(files).forEach(file => {
            if (file.size > 20 * 1024 * 1024) {
                alert(`File ${file.name} melebihi 20MB`);
                return;
            }

            if (!file.type.match('image.*')) {
                alert(`File ${file.name} bukan gambar`);
                return;
            }

            uploadedFiles.push(file);
            addFilePreview(file);
        });

        if (uploadedFiles.length >= 3) {
            document.getElementById('photo-error').style.display = 'none';
        }

        playSound('upload');
    }

    function addFilePreview(file) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const previewContainer = document.getElementById('file-preview');
            const previewElement = document.createElement('div');
            previewElement.className = 'file-preview';
            previewElement.innerHTML = `
                <img src="${event.target.result}" alt="Preview">
                <button class="remove-file" title="Hapus foto"><i class="fas fa-times"></i></button>
                <span class="file-label">${file.name}</span>
            `;

            previewElement.querySelector('.remove-file').addEventListener('click', function() {
                previewElement.remove();
                uploadedFiles = uploadedFiles.filter(f => f !== file);

                if (uploadedFiles.length < 3) {
                    document.getElementById('photo-error').style.display = 'block';
                }
            });

            previewContainer.appendChild(previewElement);
        };
        reader.readAsDataURL(file);
    }

    // Face Recognition
    async function initFaceRecognition() {
        try {
            // Load face-api models
            await faceapi.nets.tinyFaceDetector.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models');
            await faceapi.nets.faceLandmark68Net.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models');
            await faceapi.nets.faceRecognitionNet.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models');
            await faceapi.nets.faceExpressionNet.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models');

            // Enable buttons
            ['capture-face', 'switch-camera', 'retake-face', 'use-face'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.disabled = false;
            });

            // Add event listeners
            document.getElementById('capture-face').addEventListener('click', captureFace);
            document.getElementById('switch-camera').addEventListener('click', switchCamera);
            document.getElementById('retake-face').addEventListener('click', retakeFace);
            document.getElementById('use-face').addEventListener('click', useFaceImage);
            document.getElementById('face-verify-btn').addEventListener('click', verifyFaceWithKTP);

            // Start camera
            await startFaceCamera();
        } catch (error) {
            console.error("Gagal memuat face recognition:", error);
            document.getElementById('face-error').textContent = "Face recognition tidak tersedia";
            document.getElementById('face-error').style.display = 'block';
        }
    }

    async function startFaceCamera() {
        try {
            const video = document.getElementById('face-video');
            
            // Stop any existing stream
            if (faceStream) {
                faceStream.getTracks().forEach(track => track.stop());
            }
            
            // Get user media
            faceStream = await navigator.mediaDevices.getUserMedia({
                video: {
                    facingMode: currentCamera,
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                },
                audio: false
            });

            video.srcObject = faceStream;
            startFaceDetection();
        } catch (error) {
            console.error("Error accessing camera:", error);
            document.getElementById('face-error').textContent = "Akses kamera ditolak. Pastikan izin diberikan.";
            document.getElementById('face-error').style.display = 'block';
        }
    }

    function startFaceDetection() {
        const video = document.getElementById('face-video');
        const canvas = document.getElementById('face-canvas');
        const displaySize = { width: video.width, height: video.height };

        faceapi.matchDimensions(canvas, displaySize);

        // Clear any existing interval
        if (faceDetectionInterval) clearInterval(faceDetectionInterval);

        faceDetectionInterval = setInterval(async () => {
            const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions())
                .withFaceLandmarks()
                .withFaceExpressions();
            
            canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);

            if (detections.length > 0) {
                const resizedDetections = faceapi.resizeResults(detections, displaySize);
                faceapi.draw.drawDetections(canvas, resizedDetections);
                faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);
                
                // Draw face expressions
                const minProbability = 0.05;
                faceapi.draw.drawFaceExpressions(canvas, resizedDetections, minProbability);
                
                document.getElementById('capture-face').disabled = false;
            } else {
                document.getElementById('capture-face').disabled = true;
            }
        }, 100);
    }

    function captureFace() {
        const video = document.getElementById('face-video');
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        capturedFaceImage = canvas.toDataURL('image/png');

        document.getElementById('face-image').src = capturedFaceImage;
        document.getElementById('face-result').style.display = 'block';

        document.getElementById('capture-face').style.display = 'none';
        document.getElementById('switch-camera').style.display = 'none';
        document.getElementById('retake-face').style.display = 'inline-block';
        document.getElementById('use-face').style.display = 'inline-block';

        clearInterval(faceDetectionInterval);

        speak("Foto wajah berhasil diambil. Silakan periksa dan klik gunakan jika sudah sesuai.");
        playSound('success');
    }

    async function switchCamera() {
        currentCamera = currentCamera === 'user' ? 'environment' : 'user';
        await startFaceCamera();
        speak(`Kamera ${currentCamera === 'user' ? 'depan' : 'belakang'} aktif`);
    }

    function retakeFace() {
        document.getElementById('face-result').style.display = 'none';
        document.getElementById('capture-face').style.display = 'inline-block';
        document.getElementById('switch-camera').style.display = 'inline-block';
        document.getElementById('retake-face').style.display = 'none';
        document.getElementById('use-face').style.display = 'none';

        startFaceDetection();
        speak("Silakan ambil foto wajah lagi.");
    }

    function useFaceImage() {
        localStorage.setItem('faceImage', capturedFaceImage);

        document.getElementById('face-video').style.display = 'none';
        document.getElementById('face-canvas').style.display = 'none';

        updateAIMessage("Foto wajah sudah disimpan!");
        speak("Foto wajah sudah saya simpan. Anda bisa lanjut mengisi form.");
        triggerMiniConfetti();

        const facePreview = document.createElement('div');
        facePreview.className = 'file-preview';
        facePreview.innerHTML = `
            <img src="${capturedFaceImage}" alt="Foto Wajah">
            <span class="file-label">Wajah Pemilik</span>
        `;
        document.getElementById('file-preview').prepend(facePreview);

        const faceStatus = document.getElementById('face-status');
        if (faceStatus) {
            faceStatus.className = 'status-green';
            faceStatus.innerHTML = '<i class="fas fa-check"></i> Sudah Upload';
        }
    }

    async function verifyFaceWithKTP() {
        if (!capturedFaceImage) {
            updateAIMessage("Ambil foto wajah terlebih dahulu!");
            speak("Silakan ambil foto wajah terlebih dahulu sebelum verifikasi dengan KTP.");
            return;
        }

        const ktpPreview = document.getElementById('ktp-preview');
        if (!ktpPreview || ktpPreview.children.length === 0) {
            updateAIMessage("Upload foto KTP terlebih dahulu!");
            speak("Silakan upload foto KTP terlebih dahulu untuk verifikasi.");
            return;
        }

        // Simulate face verification (in real implementation, this would use proper face matching)
        updateAIMessage("Memverifikasi wajah dengan foto KTP...");
        speak("Sedang memverifikasi kesesuaian wajah dengan foto KTP. Mohon tunggu.");

        // Simulate API call delay
        setTimeout(() => {
            const isMatch = Math.random() > 0.3; // 70% chance of match for demo
            
            if (isMatch) {
                updateAIMessage("Verifikasi berhasil! Wajah sesuai dengan foto KTP.");
                speak("Verifikasi berhasil! Wajah Anda sesuai dengan foto KTP.");
                triggerMiniConfetti();
                
                // Auto-fill name from KTP (simulated)
                const ktpNames = ['Budi Santoso', 'Siti Rahayu', 'Agus Wijaya', 'Dewi Lestari', 'Joko Prasetyo'];
                const randomName = ktpNames[Math.floor(Math.random() * ktpNames.length)];
                document.getElementById('full-name').value = randomName;
            } else {
                updateAIMessage("Verifikasi gagal! Wajah tidak sesuai dengan foto KTP.");
                speak("Mohon maaf, verifikasi gagal. Wajah tidak sesuai dengan foto KTP. Silakan coba lagi.");
                playSound('error');
            }
        }, 2000);
    }

    function stopFaceCamera() {
        if (faceStream) faceStream.getTracks().forEach(track => track.stop());
        if (faceDetectionInterval) clearInterval(faceDetectionInterval);
    }
    // ==================== PART 3: VOICE COMMAND & AI ASSISTANT ====================
    function initVoiceRecognition() {
        try {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'id-ID';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                isListening = true;
                document.getElementById('voice-command').style.display = 'flex';
                document.getElementById('ai-button').classList.add('listening');
                playSound('voice');
            };

            recognition.onresult = event => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                currentCommand = transcript;
                document.getElementById('voice-text').textContent = transcript;
                processVoiceCommand(transcript);
            };

            recognition.onerror = event => {
                console.error('Error occurred in recognition: ' + event.error);
                stopListening();
            };

            recognition.onend = () => stopListening();
        } catch (e) {
            console.error("Browser tidak mendukung Speech Recognition:", e);
            updateAIMessage("Browser Anda tidak mendukung fitur suara. Gunakan Chrome terbaru.");
        }
    }

    function startListening() {
        if (!recognition) initVoiceRecognition();
        try {
            recognition.start();
            console.log('Ready to receive a command.');
        } catch (e) {
            console.error('Error:', e);
            updateAIMessage("Gagal mengakses mikrofon. Pastikan izin sudah diberikan.");
        }
    }

    function stopListening() {
        isListening = false;
        document.getElementById('voice-command').style.display = 'none';
        document.getElementById('ai-button').classList.remove('listening');
    }

    function processVoiceCommand(command) {
        updateAIMessage(`Memproses perintah: "${command}"`);
        command = command.toLowerCase();

        const commands = {
            'halo quantum': () => {
                speak("Halo Admin! Ada yang bisa saya bantu?");
                updateAIMessage("Halo Admin! Silakan beri perintah.");
            },
            'isi data pemilik': () => {
                speak("Mengisi data pemilik. Silakan sebutkan nama lengkap.");
                updateAIMessage("Silakan sebutkan nama lengkap pemilik.");
            },
            'cek harga': checkPhonePrice,
            'isi data admin': autoFillForm,
            'buka kamera': () => {
                document.getElementById('capture-face').click();
                speak("Membuka kamera untuk pengenalan wajah.");
            },
            'ganti kamera': () => {
                document.getElementById('switch-camera').click();
                speak("Mengganti kamera.");
            },
            'verifikasi wajah': verifyFaceWithKTP,
            'reset form': () => {
                document.getElementById('quantum-form').reset();
                if (ownerSignaturePad) ownerSignaturePad.clear();
                if (adminSignaturePad) adminSignaturePad.clear();
                speak("Form sudah direset ke kondisi awal.");
                updateAIMessage("Form telah direset.");
            },
            'generate pdf': () => {
                if (validateForm()) {
                    showPreview();
                    speak("Membuat preview dokumen PDF.");
                } else {
                    speak("Form belum lengkap. Silakan isi semua data yang diperlukan.");
                }
            },
            'nama saya': (cmd) => {
                const name = cmd.replace('nama saya', '').trim();
                if (name) {
                    localStorage.setItem('adminName', name);
                    document.getElementById('admin-name-footer').textContent = name;
                    speak(`Halo ${name}! Senang bekerja dengan Anda.`);
                    updateAIMessage(`Halo ${name}! Ada yang bisa saya bantu?`);
                }
            },
            'harga pasaran': checkPhonePrice
        };

        let commandExecuted = false;
        for (const cmd in commands) {
            if (command.includes(cmd)) {
                commands[cmd](command);
                commandExecuted = true;
                break;
            }
        }

        if (!commandExecuted) {
            speak("Maaf, saya tidak mengerti perintah itu. Coba lagi atau lihat contoh perintah.");
            updateAIMessage("Perintah tidak dikenali. Coba lagi ya!");
        }
    }

    function initAIAssistant() {
        const aiButton = document.getElementById('ai-button');
        const aiPanel = document.getElementById('ai-panel');
        const aiClose = document.getElementById('ai-close');
        const voiceCommandBtn = document.getElementById('voice-command-btn');
        const autoFillBtn = document.getElementById('auto-fill-btn');
        const priceCheckBtn = document.getElementById('price-check-btn');
        const faceVerifyBtn = document.getElementById('face-verify-btn');
        
        // Toggle AI Panel
        aiButton.addEventListener('click', function() {
            aiPanel.style.display = aiPanel.style.display === 'block' ? 'none' : 'block';
        });
        
        // Close AI Panel
        aiClose.addEventListener('click', function() {
            aiPanel.style.display = 'none';
        });
        
        // Voice Command Button
        voiceCommandBtn.addEventListener('click', function() {
            startListening();
            aiPanel.style.display = 'none';
        });
        
        // Auto Fill Button
        autoFillBtn.addEventListener('click', function() {
            autoFillForm();
            aiPanel.style.display = 'none';
        });
        
        // Price Check Button
        priceCheckBtn.addEventListener('click', function() {
            checkPhonePrice();
            aiPanel.style.display = 'none';
        });
        
        // Face Verify Button
        faceVerifyBtn.addEventListener('click', function() {
            verifyFaceWithKTP();
            aiPanel.style.display = 'none';
        });
        
        // Update AI Message
        updateAIMessage("Siap membantu Anda, Admin! 😊");
    }

    function updateAIMessage(message) {
        const aiMessage = document.getElementById('ai-message');
        aiMessage.textContent = message;
    }

    function autoFillForm() {
        // Fill admin data from localStorage or defaults
        const adminName = localStorage.getItem('adminName') || 'Admin Quantum';
        const adminPhone = localStorage.getItem('adminPhone') || '8123456789';
        const adminEmail = localStorage.getItem('adminEmail') || 'admin@quantum.com';
        
        document.getElementById('admin-name').value = adminName;
        document.getElementById('admin-phone').value = adminPhone;
        document.getElementById('admin-email').value = adminEmail;
        
        // Set start date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('start-date').value = today;
        
        updateAIMessage("Form admin sudah diisi otomatis! 🚀");
        speak("Data admin sudah saya isi otomatis. Silakan periksa dan sesuaikan jika perlu.");
        
        triggerMiniConfetti();
    }

    async function checkPhonePrice() {
        const brand = document.getElementById('phone-brand').value;
        const model = document.getElementById('phone-model').value;
        const ram = document.getElementById('ram').value;
        const storage = document.getElementById('storage').value;
        
        if (!brand || !model) {
            updateAIMessage("Mohon isi merek dan model handphone terlebih dahulu.");
            speak("Maaf, saya butuh merek dan model handphone untuk mengecek harga.");
            return;
        }
        
        updateAIMessage(`Mengecek harga ${brand} ${model} ${ram ? ram+'GB RAM' : ''} ${storage ? storage+'GB Storage' : ''} di pasaran...`);
        speak(`Saya sedang mengecek harga ${brand} ${model} di pasaran. Mohon tunggu sebentar.`);
        
        try {
            // In a real implementation, this would be an API call to a price database
            // For demo purposes, we'll simulate with a timeout
            setTimeout(() => {
                // Sample price data for demo
                const priceData = {
                    'iPhone 13': { 
                        '4-64': { bekas: 'Rp 5.000.000 - Rp 6.500.000', baru: 'Rp 8.000.000 - Rp 10.000.000' },
                        '6-128': { bekas: 'Rp 6.500.000 - Rp 8.000.000', baru: 'Rp 10.000.000 - Rp 12.000.000' },
                        '8-256': { bekas: 'Rp 8.000.000 - Rp 10.000.000', baru: 'Rp 14.000.000 - Rp 16.000.000' },
                        'default': { bekas: 'Rp 6.000.000 - Rp 8.000.000', baru: 'Rp 10.000.000 - Rp 12.000.000' }
                    },
                    'Samsung S21': { 
                        '8-128': { bekas: 'Rp 4.500.000 - Rp 6.000.000', baru: 'Rp 8.000.000 - Rp 10.000.000' },
                        '12-256': { bekas: 'Rp 6.000.000 - Rp 7.500.000', baru: 'Rp 10.000.000 - Rp 12.000.000' },
                        'default': { bekas: 'Rp 5.000.000 - Rp 6.500.000', baru: 'Rp 9.000.000 - Rp 11.000.000' }
                    },
                    'Xiaomi Redmi Note 10': { 
                        '4-64': { bekas: 'Rp 1.800.000 - Rp 2.500.000', baru: 'Rp 2.800.000 - Rp 3.200.000' },
                        '6-128': { bekas: 'Rp 2.500.000 - Rp 3.200.000', baru: 'Rp 3.500.000 - Rp 4.000.000' },
                        'default': { bekas: 'Rp 2.000.000 - Rp 2.800.000', baru: 'Rp 3.000.000 - Rp 3.500.000' }
                    },
                    'default': { 
                        'default': { bekas: 'Rp 3.000.000 - Rp 5.000.000', baru: 'Rp 6.000.000 - Rp 8.000.000' }
                    }
                };
                
                const priceKey = `${brand} ${model}`;
                const specKey = ram && storage ? `${ram}-${storage}` : 'default';
                const condition = document.getElementById('phone-condition').value === 'Bekas' ? 'bekas' : 'baru';
                
                let price = priceData['default']['default'][condition];
                
                if (priceData[priceKey]) {
                    if (priceData[priceKey][specKey]) {
                        price = priceData[priceKey][specKey][condition];
                    } else {
                        price = priceData[priceKey]['default'][condition];
                    }
                }
                
                updateAIMessage(`Harga pasaran ${brand} ${model} ${ram ? ram+'GB RAM ' : ''}${storage ? storage+'GB ' : ''}(${condition}) di pasaran: ${price}`);
                speak(`Untuk ${brand} ${model} ${ram ? 'dengan RAM '+ram+'GB ' : ''}${storage ? 'dan penyimpanan '+storage+'GB ' : ''}kondisi ${condition}, harga pasaran sekitar ${price}.`);
                
                // Show suggestion button
                document.getElementById('price-suggestion').style.display = 'block';
                document.getElementById('suggested-price').textContent = price.split('-')[0].trim();
                
            }, 2000);
        } catch (error) {
            console.error("Error checking price:", error);
            updateAIMessage("Gagal mengecek harga. Silakan coba lagi.");
            speak("Maaf, terjadi kesalahan saat mengecek harga. Silakan coba lagi.");
        }
    }

    function applySuggestedPrice() {
        const suggestedPrice = document.getElementById('suggested-price').textContent;
        document.getElementById('price').value = suggestedPrice;
        updateAIMessage("Harga rekomendasi telah diterapkan");
        speak("Harga rekomendasi sudah saya terapkan ke form");
        triggerMiniConfetti();
    }
      // ==================== PART 4: PDF GENERATION ====================
    function initModalHandlers() {
        const generateBtn = document.getElementById('generate-pdf');
        const closePreviewBtn = document.getElementById('close-preview');
        const closeSuccessBtn = document.getElementById('close-modal');

        if (generateBtn) {
            generateBtn.addEventListener('click', generatePDF);
        }

        if (closePreviewBtn) {
            closePreviewBtn.addEventListener('click', function() {
                document.getElementById('preview-modal').style.display = 'none';
            });
        }

        if (closeSuccessBtn) {
            closeSuccessBtn.addEventListener('click', function() {
                document.getElementById('success-modal').style.display = 'none';
            });
        }
    }

    function showPreview() {
        const previewContent = document.getElementById('preview-content');
        previewContent.innerHTML = `
            <h3>Data Pemilik</h3>
            <p><strong>Nama:</strong> ${document.getElementById('full-name').value}</p>
            <p><strong>No. KTP:</strong> ${document.getElementById('ktp').value}</p>
            <p><strong>WhatsApp:</strong> +62${document.getElementById('phone').value}</p>
            <p><strong>Email:</strong> ${document.getElementById('email').value}</p>
            <p><strong>Alamat:</strong> ${document.getElementById('address').value}</p>

            <h3>Data Handphone</h3>
            <p><strong>Merek:</strong> ${document.getElementById('phone-brand').value}</p>
            <p><strong>Model:</strong> ${document.getElementById('phone-model').value}</p>
            <p><strong>Kondisi:</strong> ${document.getElementById('phone-condition').value}</p>
            <p><strong>RAM:</strong> ${document.getElementById('ram').value || '-'} GB</p>
            <p><strong>Penyimpanan:</strong> ${document.getElementById('storage').value || '-'} GB</p>
            <p><strong>IMEI 1:</strong> ${document.getElementById('imei1').value}</p>
            <p><strong>IMEI 2:</strong> ${document.getElementById('imei2').value || '-'}</p>
            <p><strong>Harga Setor:</strong> ${document.getElementById('price').value}</p>
            <p><strong>Periode:</strong> ${document.getElementById('start-date').value} sampai ${document.getElementById('end-date').value}</p>

            <h3>Data Admin</h3>
            <p><strong>Nama Admin:</strong> ${document.getElementById('admin-name').value}</p>
            <p><strong>No. KTP Admin:</strong> ${document.getElementById('admin-ktp').value}</p>
            <p><strong>WhatsApp Admin:</strong> +62${document.getElementById('admin-phone').value}</p>
            <p><strong>Email Admin:</strong> ${document.getElementById('admin-email').value}</p>
        `;

        document.getElementById('preview-modal').style.display = 'flex';
    }

    async function generatePDF() {
        // Show quantum effect
        document.getElementById('quantum-loader').style.display = 'flex';
        document.getElementById('quantum-text').textContent = "MEMBUAT DOKUMEN QUANTUM PDF...";
        
        // Add delay for dramatic effect
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        try {
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            
            // Add logo
            const logo = await loadImage('https://i.imgur.com/8QHjrmd.png');
            pdf.addImage(logo, 'PNG', 15, 10, 30, 15);
            
            // Add title
            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(18);
            pdf.setTextColor(40, 40, 40);
            pdf.text('PERJANJIAN TITIP JUAL HANDPHONE', 105, 20, { align: 'center' });
            
            // Add document info
            pdf.setFont('helvetica', 'normal');
            pdf.setFontSize(10);
            pdf.setTextColor(100, 100, 100);
            const docNumber = `QTJ-${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,'0')}${String(new Date().getDate()).padStart(2,'0')}-${Math.floor(1000 + Math.random() * 9000)}`;
            pdf.text(`No. Dokumen: ${docNumber}`, 15, 30);
            pdf.text(`Tanggal: ${new Date().toLocaleDateString('id-ID')}`, 180, 30, { align: 'right' });
            
            // Add content
            pdf.setFontSize(12);
            pdf.setTextColor(60, 60, 60);
            let yPos = 40;
            
            // Add party data
            pdf.setFont('helvetica', 'bold');
            pdf.text('PIHAK PERTAMA (PEMILIK)', 15, yPos);
            yPos += 7;
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Nama: ${document.getElementById('full-name').value}`, 20, yPos); yPos += 7;
            pdf.text(`No. KTP: ${document.getElementById('ktp').value}`, 20, yPos); yPos += 7;
            pdf.text(`WhatsApp: +62${document.getElementById('phone').value}`, 20, yPos); yPos += 7;
            pdf.text(`Email: ${document.getElementById('email').value}`, 20, yPos); yPos += 7;
            pdf.text(`Alamat: ${document.getElementById('address').value}`, 20, yPos); 
            
            // Add face image if available
            if (capturedFaceImage) {
                yPos += 5;
                pdf.text(`Foto Wajah Pemilik:`, 20, yPos); yPos += 20;
                const faceImg = await loadImage(capturedFaceImage);
                pdf.addImage(faceImg, 'JPEG', 20, yPos, 30, 30);
                yPos += 35;
            } else {
                yPos += 10;
            }
            
            pdf.setFont('helvetica', 'bold');
            pdf.text('PIHAK KEDUA (ADMIN)', 15, yPos);
            yPos += 7;
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Nama: ${document.getElementById('admin-name').value}`, 20, yPos); yPos += 7;
            pdf.text(`No. KTP: ${document.getElementById('admin-ktp').value}`, 20, yPos); yPos += 7;
            pdf.text(`WhatsApp: +62${document.getElementById('admin-phone').value}`, 20, yPos); yPos += 7;
            pdf.text(`Email: ${document.getElementById('admin-email').value}`, 20, yPos); yPos += 10;
            
            // Add phone data
            pdf.setFont('helvetica', 'bold');
            pdf.text('DATA HANDPHONE', 15, yPos);
            yPos += 7;
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Merek: ${document.getElementById('phone-brand').value}`, 20, yPos); yPos += 7;
            pdf.text(`Model: ${document.getElementById('phone-model').value}`, 20, yPos); yPos += 7;
            pdf.text(`RAM: ${document.getElementById('ram').value || '-'} GB`, 20, yPos); yPos += 7;
            pdf.text(`Penyimpanan: ${document.getElementById('storage').value || '-'} GB`, 20, yPos); yPos += 7;
            
            // Add condition and completeness
            const condition = document.getElementById('phone-condition').value;
            pdf.text(`Kondisi: ${condition || '-'}`, 20, yPos); yPos += 7;
            
            if (condition === 'Bekas') {
                const completeness = document.getElementById('phone-completeness').value;
                pdf.text(`Kelengkapan: ${completeness || '-'}`, 20, yPos); yPos += 7;
                
                if (completeness === 'Tidak Lengkap') {
                    const detail = document.getElementById('completeness-detail').value;
                    pdf.text(`Detail Kelengkapan: ${detail || '-'}`, 20, yPos); yPos += 7;
                }
            }
            
            pdf.text(`IMEI 1: ${document.getElementById('imei1').value}`, 20, yPos); yPos += 7;
            pdf.text(`IMEI 2: ${document.getElementById('imei2').value || '-'}`, 20, yPos); yPos += 7;
            
            const priceValue = document.getElementById('price').value.replace(/[^0-9]/g, '');
            const formattedPrice = priceValue ? parseInt(priceValue, 10).toLocaleString('id-ID') : '0';
            pdf.text(`Harga Setor: Rp ${formattedPrice}`, 20, yPos); yPos += 7;
            
            const startDate = new Date(document.getElementById('start-date').value);
            const endDate = new Date(document.getElementById('end-date').value);
            pdf.text(`Periode: ${startDate.toLocaleDateString('id-ID')} - ${endDate.toLocaleDateString('id-ID')}`, 20, yPos); yPos += 10;
            
            // Add terms
            pdf.setFont('helvetica', 'bold');
            pdf.text('PASAL-PASAL PERJANJIAN', 15, yPos); yPos += 7;
            pdf.setFont('helvetica', 'normal');
            [
                `1. Pihak Pertama menyerahkan dan Pihak Kedua menerima titipan berupa handphone ${document.getElementById('phone-brand').value} ${document.getElementById('phone-model').value} dengan harga Rp ${formattedPrice} untuk dijual oleh Pihak Kedua.`,
                '2. Pihak Kedua bertanggung jawab penuh atas keamanan dan keutuhan handphone selama dalam masa penitipan.',
                '3. Apabila handphone terjual, Pihak Kedua wajib mentransfer dana hasil penjualan (setelah dipotong komisi) kepada Pihak Pertama dalam waktu 1x24 jam setelah pembayaran diterima.',
                '4. Pihak Kedua berhak mendapatkan komisi sebesar 10% dari harga jual handphone.',
                `5. Perjanjian ini berlaku selama 14 (empat belas) hari kalender terhitung sejak tanggal penandatanganan (${startDate.toLocaleDateString('id-ID')} - ${endDate.toLocaleDateString('id-ID')}).`,
                '6. Jika handphone tidak terjual dalam masa perjanjian, Pihak Kedua wajib mengembalikan handphone dalam keadaan utuh kepada Pihak Pertama.',
                '7. Segala bentuk perselisihan yang timbul dari perjanjian ini akan diselesaikan secara musyawarah untuk mufakat.'
            ].forEach(term => { 
                const lines = pdf.splitTextToSize(term, 170);
                lines.forEach(line => {
                    if (yPos > 270) {
                        pdf.addPage();
                        yPos = 20;
                    }
                    pdf.text(line, 20, yPos);
                    yPos += 7;
                });
                yPos += 2;
            });
            
            // Add photos if any
            if (uploadedFiles.length > 0 || capturedFaceImage) {
                if (yPos > 200) {
                    pdf.addPage();
                    yPos = 20;
                } else {
                    yPos += 10;
                }
                
                pdf.setFont('helvetica', 'bold');
                pdf.text('DOKUMEN PENDUKUNG', 15, yPos); yPos += 7;
                
                let photoX = 20;
                let photoY = yPos;
                const photoSize = 40;
                const gap = 10;
                let photosInRow = 0;
                
                // Add face image first if available
                if (capturedFaceImage) {
                    try {
                        const faceImg = await loadImage(capturedFaceImage);
                        pdf.addImage(faceImg, 'JPEG', photoX, photoY, photoSize, photoSize);
                        pdf.text('Wajah Pemilik', photoX, photoY + photoSize + 5);
                        photoX += photoSize + gap;
                        photosInRow++;
                    } catch (error) {
                        console.error('Error loading face image:', error);
                    }
                }
                          // Add phone photos
                for (let i = 0; i < Math.min(uploadedFiles.length, 4); i++) {
                    if (photosInRow >= 4 || photoX + photoSize > 180) {
                        photoX = 20;
                        photoY += photoSize + gap + 15;
                        photosInRow = 0;
                        
                        if (photoY + photoSize > 270) {
                            pdf.addPage();
                            photoY = 20;
                        }
                    }
                    
                    try {
                        const img = await loadImage(URL.createObjectURL(uploadedFiles[i]));
                        pdf.addImage(img, 'JPEG', photoX, photoY, photoSize, photoSize);
                        photoX += photoSize + gap;
                        photosInRow++;
                    } catch (error) {
                        console.error('Error loading image:', error);
                    }
                }
                
                yPos = photoY + photoSize + 15;
            }
            
            // Add signatures
            if (yPos > 200) {
                pdf.addPage();
                yPos = 20;
            } else {
                yPos += 10;
            }
            
            pdf.setFont('helvetica', 'bold');
            pdf.text('TANDA TANGAN', 15, yPos); yPos += 10;
            
            if (!ownerSignaturePad.isEmpty()) {
                const ownerSig = ownerSignaturePad.toDataURL();
                pdf.addImage(ownerSig, 'PNG', 30, yPos, 50, 20);
                pdf.text(`Pemilik: ${document.getElementById('full-name').value}`, 30, yPos + 25);
            }
            
            if (!adminSignaturePad.isEmpty()) {
                const adminSig = adminSignaturePad.toDataURL();
                pdf.addImage(adminSig, 'PNG', 130, yPos, 50, 20);
                pdf.text(`Admin: ${document.getElementById('admin-name').value}`, 130, yPos + 25);
            }

            // Add footer
            pdf.setFontSize(8);
            pdf.setTextColor(120, 120, 120);
            pdf.text('Dokumen ini sah dan berlaku tanpa stempel berdasarkan Pasal 1320 KUHPerdata.', 105, 287, { align: 'center' });
            pdf.text('Dibuat dengan Quantum PDF Generator - © 2025 Quantum Titip Jual', 105, 290, { align: 'center' });
            
            // Save PDF
            pdf.save(`Perjanjian_Titip_Jual_${docNumber}.pdf`);
            
            // Hide quantum loader
            document.getElementById('quantum-loader').style.display = 'none';
            
            // Show success modal
            document.getElementById('preview-modal').style.display = 'none';
            document.getElementById('success-modal').style.display = 'flex';
            
            // Play success sound
            speak("Dokumen PDF sudah selesai dibuat dan tersimpan di folder Downloads Anda. Silakan kirim ke customer melalui WhatsApp.");
            
            // Trigger confetti
            triggerConfetti();
        } catch (error) {
            console.error("Error generating PDF:", error);
            document.getElementById('quantum-loader').style.display = 'none';
            alert("Terjadi kesalahan saat membuat PDF. Silakan coba lagi.");
            speak("Maaf, terjadi kesalahan saat membuat dokumen PDF. Silakan coba lagi.");
        }
    }

    function loadImage(url) {
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.crossOrigin = 'Anonymous';
            img.onload = () => resolve(img);
            img.onerror = reject;
            img.src = url;
        });
    }

    // ==================== PART 5: UTILITY FUNCTIONS ====================
    function initConditionalForm() {
        // Phone condition change
        document.getElementById('phone-condition').addEventListener('change', function() {
            const completenessWrapper = document.getElementById('completeness-wrapper');
            if (this.value === 'Bekas') {
                completenessWrapper.style.display = 'block';
                completenessWrapper.classList.add('fade-in');
            } else {
                completenessWrapper.style.display = 'none';
                document.getElementById('completeness-detail-wrapper').style.display = 'none';
            }
        });

        // Completeness change
        document.getElementById('phone-completeness').addEventListener('change', function() {
            const detailWrapper = document.getElementById('completeness-detail-wrapper');
            if (this.value === 'Tidak Lengkap') {
                detailWrapper.style.display = 'block';
                detailWrapper.classList.add('fade-in');
            } else {
                detailWrapper.style.display = 'none';
            }
        });
    }

    function startWakeWordDetection() {
        document.addEventListener('keypress', function(e) {
            if (e.key === 'q') { // Wake word shortcut for demo
                startListening();
            }
        });
    }

    function loadDraft() {
        // Load admin name if exists
        const adminName = localStorage.getItem('adminName');
        if (adminName) {
            document.getElementById('admin-name-footer').textContent = adminName;
        }
        
        // Load face image if exists
        const faceImage = localStorage.getItem('faceImage');
        if (faceImage) {
            capturedFaceImage = faceImage;
            document.getElementById('face-image').src = faceImage;
            document.getElementById('face-result').style.display = 'block';
            document.getElementById('face-video').style.display = 'none';
            document.getElementById('face-canvas').style.display = 'none';
            
            const facePreview = document.createElement('div');
            facePreview.className = 'file-preview';
            facePreview.innerHTML = `
                <img src="${faceImage}" alt="Foto Wajah">
                <span class="file-label">Wajah Pemilik</span>
            `;
            document.getElementById('file-preview').prepend(facePreview);
        }
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'id-ID';
            window.speechSynthesis.speak(utterance);
        }
    }

    function playSound(type) {
        const sound = document.getElementById(`${type}-sound`);
        if (sound) {
            sound.currentTime = 0;
            sound.play();
        }
    }

    function triggerConfetti() {
        confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#00f0ff', '#0077ff', '#a0f0ff']
        });
    }

    function triggerMiniConfetti() {
        confetti({
            particleCount: 50,
            spread: 50,
            origin: { y: 0.6 },
            colors: ['#00f0ff', '#0077ff'],
            scalar: 0.8
        });
    }

    // Cleanup on exit
    window.addEventListener('beforeunload', function() {
        stopFaceCamera();
        if (isListening) {
            stopListening();
        }
    });
    </script>
</body>
</html>
